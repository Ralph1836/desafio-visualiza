
# Desafio DevOps: Visualiza üöÄ

Bem-vindo ao Desafio da Visualiza\! Sua miss√£o √© construir uma aplica√ß√£o Python a partir de um conjunto de requisitos, prepar√°-la para produ√ß√£o com as melhores pr√°ticas de containeriza√ß√£o e, por fim, automatizar seu processo de integra√ß√£o cont√≠nua (CI).

Este desafio testa suas habilidades de ponta a ponta, desde a cria√ß√£o de uma API funcional at√© a automa√ß√£o de seu empacotamento.

## √çndice

  * [Sobre a Aplica√ß√£o que Voc√™ Ir√° Construir](https://www.google.com/search?q=%23sobre-a-aplica%C3%A7%C3%A3o-que-voc%C3%AA-ir%C3%A1-construir)
  * [Vis√£o Geral do Desafio](https://www.google.com/search?q=%23vis%C3%A3o-geral-do-desafio)
  * [Fase 1: Constru√ß√£o e Execu√ß√£o da Aplica√ß√£o Local](https://www.google.com/search?q=%23fase-1-constru%C3%A7%C3%A3o-e-execu%C3%A7%C3%A3o-da-aplica%C3%A7%C3%A3o-local)
  * [Fase 2: Containeriza√ß√£o com Docker](https://www.google.com/search?q=%23fase-2-containeriza%C3%A7%C3%A3o-com-docker)
  * [Fase 3: Gerenciamento Local com Docker Compose](https://www.google.com/search?q=%23fase-3-gerenciamento-local-com-docker-compose)
  * [Fase 4: CI - Integra√ß√£o Cont√≠nua com GitHub Actions](https://www.google.com/search?q=%23fase-4-ci---integra%C3%A7%C3%A3o-cont%C3%ADnua-com-github-actions)
  * [O que ser√° Avaliado?](https://www.google.com/search?q=%23o-que-ser%C3%A1-avaliado)
  * [Dicas e Recursos √öteis](https://www.google.com/search?q=%23dicas-e-recursos-%C3%BAteis)

## Sobre a Aplica√ß√£o que Voc√™ Ir√° Construir

Sua primeira tarefa ser√° criar um microservi√ßo chamado **Visualiza**, utilizando **Python** e o framework **FastAPI**.

  * **Funcionalidade Principal:** A API dever√° expor um endpoint que busca e retorna os metadados da "Imagem Astron√¥mica do Dia" (APOD) da API p√∫blica da NASA.
  * **Endpoints Requeridos:**
      * `GET /apod`: Retorna os dados da imagem do dia.
      * `GET /health`: Um endpoint simples de health check.
      * `GET /`: Um endpoint raiz com uma mensagem de boas-vindas.

## Vis√£o Geral do Desafio

O objetivo √© executar um ciclo de desenvolvimento completo, passando por 4 est√°gios:

1.  **Constru√ß√£o da Aplica√ß√£o:** Escrever o c√≥digo da API em Python com base nas especifica√ß√µes.
2.  **Containeriza√ß√£o:** Criar uma imagem Docker da aplica√ß√£o.
3.  **Gerenciamento com Docker Compose:** Padronizar a execu√ß√£o do ambiente de desenvolvimento.
4.  **Automa√ß√£o com CI:** Criar um pipeline que automaticamente testa e publica a imagem Docker.

-----

## Fase 1: Constru√ß√£o e Execu√ß√£o da Aplica√ß√£o Local

Antes de pensar em Docker, voc√™ deve construir e validar a aplica√ß√£o em sua m√°quina.

### Pr√©-requisitos

  * [Python 3.9+](https://www.python.org/downloads/)

### Suas Tarefas

1.  **Crie a Estrutura do Projeto:**
    Organize seus arquivos na seguinte estrutura:

    ```
    visualiza-challenge/
    ‚îú‚îÄ‚îÄ .github/
    ‚îÇ   ‚îî‚îÄ‚îÄ workflows/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py      # Arquivo vazio para o m√≥dulo
    ‚îÇ   ‚îî‚îÄ‚îÄ main.py          # Onde seu c√≥digo FastAPI ir√° viver
    ‚îú‚îÄ‚îÄ .env
    ‚îú‚îÄ‚îÄ .gitignore
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ docker-compose.yml
    ‚îú‚îÄ‚îÄ README.md
    ‚îî‚îÄ‚îÄ requirements.txt
    ```

2.  **Desenvolva a Aplica√ß√£o (`src/main.py`):**
    Crie uma aplica√ß√£o FastAPI que atenda √†s seguintes **especifica√ß√µes**:

      * ‚úÖ Utilize o framework `FastAPI`.
      * ‚úÖ Use a biblioteca `python-dotenv` para carregar vari√°veis de ambiente de um arquivo `.env`.
      * ‚úÖ Implemente um endpoint `GET /` que retorne um JSON simples como: `{"message": "Bem-vindo √† Visualiza API!"}`.
      * ‚úÖ Implemente um endpoint `GET /health` que retorne um JSON com `{"status": "ok"}` e status code 200.
      * ‚úÖ Implemente um endpoint `GET /apod` que seja `async` e:
          * Utilize a biblioteca `httpx` para fazer uma requisi√ß√£o √† API da NASA (`https://api.nasa.gov/planetary/apod`).
          * Leia uma vari√°vel de ambiente `NASA_API_KEY` e a envie como par√¢metro na requisi√ß√£o.
          * Em caso de sucesso, retorne o JSON recebido da API da NASA.
          * **Implemente tratamento de erros:** Se a API da NASA retornar um erro (ex: 4xx, 5xx) ou se houver um erro de conex√£o, sua API deve retornar uma `HTTPException` do FastAPI com o status code e detalhes apropriados.

3.  **Liste as Depend√™ncias (`requirements.txt`):**
    Seu arquivo `requirements.txt` deve conter todas as bibliotecas necess√°rias para rodar a aplica√ß√£o. Isso inclui, no m√≠nimo, `fastapi`, `uvicorn`, `httpx` e `python-dotenv`.

4.  **Configure as Vari√°veis de Ambiente (`.env`):**
    Crie o arquivo `.env` e adicione sua chave da API da NASA. Voc√™ pode obter uma em [api.nasa.gov](https://api.nasa.gov/).

    ```ini
    NASA_API_KEY=SUA_CHAVE_API_AQUI
    ```

5.  **Instale e Valide sua Aplica√ß√£o:**
    Execute os seguintes comandos no terminal para testar o c√≥digo que voc√™ escreveu:

    ```bash
    # Crie e ative um ambiente virtual
    python -m venv .venv
    source .venv/bin/activate

    # Instale as depend√™ncias que voc√™ listou
    pip install -r requirements.txt

    # Execute a aplica√ß√£o
    uvicorn src.main:app --reload
    ```

    Acesse [**http://localhost:8000/docs**](https://www.google.com/search?q=http://localhost:8000/docs) e teste todos os endpoints para garantir que eles se comportam conforme as especifica√ß√µes.

-----

## Fase 2: Containeriza√ß√£o com Docker

Agora que sua aplica√ß√£o funciona localmente, empacote-a em uma imagem Docker.

**‚úÖ Requisitos:**

  * Crie um `Dockerfile` na raiz do projeto.
  * Utilize uma imagem base oficial e leve do Python (ex: `python:3.9-slim-bullseye`).
  * Aplique a t√©cnica de **multi-stage build** para uma imagem final otimizada.
  * Garanta que a aplica√ß√£o seja executada por um **usu√°rio n√£o-root** dentro do cont√™iner.
  * Otimize a ordem dos comandos para aproveitar o **cache de camadas** do Docker.

## Fase 3: Gerenciamento Local com Docker Compose

Use o Docker Compose para simplificar e padronizar a execu√ß√£o do seu cont√™iner.

**‚úÖ Requisitos:**

  * Crie um arquivo `docker-compose.yml`.
  * Defina um √∫nico servi√ßo, `api`, que ser√° constru√≠do a partir do seu `Dockerfile`.
  * Mapeie a porta 8000 do cont√™iner para a porta 8000 da sua m√°quina.
  * Configure o servi√ßo para carregar as vari√°veis de ambiente do arquivo `.env` automaticamente.
  * O comando `docker-compose up --build` deve ser suficiente para iniciar a aplica√ß√£o.

## Fase 4: CI - Integra√ß√£o Cont√≠nua com GitHub Actions

Crie um pipeline para automatizar o build e o push da sua imagem Docker.

**‚úÖ Requisitos:**

  * Crie um workflow em `.github/workflows/main.yml` que seja acionado a cada `push` na branch `main`.
  * O workflow deve:
    1.  Fazer o checkout do c√≥digo.
    2.  Fazer login de forma segura em um registro de cont√™ineres (**Docker Hub** ou **GitHub Container Registry**), usando *GitHub Secrets* para as credenciais.
    3.  Construir e fazer o push da imagem Docker para o registro, utilizando ao menos duas tags: `latest` e o identificador do commit (SHA).

## O que ser√° Avaliado?

  * **Qualidade do C√≥digo Python:** A aplica√ß√£o atende a todas as especifica√ß√µes? √â bem estruturada e inclui tratamento de erros robusto?
  * **Qualidade do C√≥digo DevOps:** Clareza, efici√™ncia e seguran√ßa do `Dockerfile`, `docker-compose.yml` e do workflow do GitHub Actions.
  * **Melhores Pr√°ticas:** Uso de multi-stage builds, usu√°rios n√£o-root, otimiza√ß√£o de cache, gerenciamento de segredos, etc.
  * **Funcionalidade:** A solu√ß√£o final funciona de ponta a ponta como descrito?
  * **Documenta√ß√£o:** A clareza das suas mensagens de commit e coment√°rios que voc√™ adicionar ao `README.md` para explicar suas decis√µes.

## Dicas e Recursos √öteis

  * **Documenta√ß√£o do FastAPI:** [https://fastapi.tiangolo.com/](https://fastapi.tiangolo.com/)
  * **Documenta√ß√£o do HTTPX:** [https://www.python-httpx.org/](https://www.python-httpx.org/)
  * **Melhores Pr√°ticas para Dockerfile:** [Docker Docs - Dockerfile best practices](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
  * **Documenta√ß√£o do Docker Compose:** [Docker Docs - Compose overview](https://docs.docker.com/compose/)
  * **Documenta√ß√£o do GitHub Actions:** [GitHub Docs - Actions](https://docs.github.com/pt/actions)

Boa sorte\! ‚ú®